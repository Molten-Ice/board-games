<!DOCTYPE html>
<html>
<head>
    <title>Catan Board Visualization</title>
    <style>
        body {
            background: #2c3e50;
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            padding: 20px;
            gap: 20px;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .board-container {
            background: #34495e;
            padding: 20px;
            border-radius: 10px;
        }

        canvas {
            border-radius: 10px;
        }

        .players-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .player-card, .bank-card {
            background: #34495e;
            padding: 15px;
            border-radius: 10px;
            color: white;
            min-width: 200px;
        }

        .player-card h3, .bank-card h3 {
            margin: 0 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 2px solid;
        }

        .player-1 h3 { border-color: #FF0000; }
        .player-2 h3 { border-color: #00FF00; }
        .player-3 h3 { border-color: #0000FF; }
        .player-4 h3 { border-color: #FFFF00; }
        .bank-card h3 { border-color: #ffffff; }

        .resource-list {
            display: grid;
            grid-template-columns: auto auto;
            gap: 5px;
        }

        .resource {
            display: flex;
            justify-content: space-between;
            padding: 3px 0;
        }

        .controls {
            background: #34495e;
            padding: 15px;
            border-radius: 10px;
            color: white;
        }

        select {
            padding: 5px;
            border-radius: 5px;
            background: #2c3e50;
            color: white;
            border: 1px solid #95a5a6;
        }

        .board-and-cards {
            display: flex;
            gap: 20px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="controls">
            <label for="player-select">View resources for player: </label>
            <select id="player-select">
                <option value="1">Player 1</option>
                <option value="2">Player 2</option>
                <option value="3">Player 3</option>
                <option value="4">Player 4</option>
            </select>
        </div>
        <div class="board-and-cards">
            <div class="board-container">
                <canvas id="boardCanvas" width="800" height="800"></canvas>
            </div>
            <div class="players-container">
                <div class="bank-card">
                    <h3>Bank</h3>
                    <div id="bank-resources" class="resource-list"></div>
                </div>
                <div class="player-card active-player">
                    <h3 id="active-player-name">Player 1</h3>
                    <div id="active-player-resources" class="resource-list"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const sf = 30.0;
        const width = 800;
        const height = 800;
        
        const playerColors = {
            1: '#FF0000',
            2: '#00FF00',
            3: '#0000FF',
            4: '#FFFF00'
        };

        const resourceColors = {
            wood: '#2ecc71',
            brick: '#e74c3c',
            wheat: '#f1c40f',
            sheep: '#95a5a6',
            ore: '#7f8c8d',
            desert: '#bdc3c7'
        };

        function getHexCoordinates(q, r) {
            let x = (3/2 * q);
            let y = (Math.sqrt(3)/2 * q + Math.sqrt(3) * r);
            x *= sf;
            y *= sf;
            x += width / 2;
            y += height / 2;
            return [x, y];
        }

        function drawHexagon(ctx, x, y, size) {
            const angleOffset = Math.PI / 6;
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angle = i * Math.PI / 3 + angleOffset;
                const xPoint = x + size * Math.cos(angle);
                const yPoint = y + size * Math.sin(angle);
                if (i === 0) {
                    ctx.moveTo(xPoint, yPoint);
                } else {
                    ctx.lineTo(xPoint, yPoint);
                }
            }
            ctx.closePath();
        }

        function drawPips(ctx, x, y, number) {
            const pipValues = {
                2: 1, 12: 1,
                3: 2, 11: 2,
                4: 3, 10: 3,
                5: 4, 9: 4,
                6: 5, 8: 5
            };

            const pips = pipValues[number] || 0;
            if (pips === 0) return;

            const pipColor = (pips === 5) ? '#e74c3c' : '#2c3e50';
            const pipSize = 3;
            const pipSpacing = 7;
            const totalWidth = (pips * pipSize * 2) - pipSize;
            let startX = x - totalWidth / 2;

            ctx.fillStyle = pipColor;
            for (let i = 0; i < pips; i++) {
                ctx.beginPath();
                ctx.arc(startX + (i * pipSpacing), y + 12, pipSize, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function drawBoard(boardState) {
            const canvas = document.getElementById('boardCanvas');
            const ctx = canvas.getContext('2d');
            
            ctx.fillStyle = '#34495e';
            ctx.fillRect(0, 0, width, height);

            // Draw hex tiles
            boardState.hexes.forEach(hex => {
                const [x, y] = getHexCoordinates(hex.q, hex.r);
                const hexSize = sf * 1.1;

                // Draw hex background
                ctx.save();
                drawHexagon(ctx, x, y, hexSize);
                ctx.fillStyle = resourceColors[hex.resource_type] || '#bdc3c7';
                ctx.fill();
                ctx.strokeStyle = '#2c3e50';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Draw number
                if (hex.resource_number > 0) {
                    ctx.fillStyle = '#2c3e50';
                    ctx.font = 'bold 16px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(hex.resource_number.toString(), x, y);
                    drawPips(ctx, x, y, hex.resource_number);
                }
                ctx.restore();
            });

            // Draw roads
            const vertexCoords = {};
            boardState.vertex_cells.forEach(v => {
                vertexCoords[v.unique_id] = [v.q, v.r];
            });

            boardState.roads.forEach(([v1_id, v2_id, owner_id]) => {
                const [q1, r1] = vertexCoords[v1_id];
                const [q2, r2] = vertexCoords[v2_id];
                const [x1, y1] = getHexCoordinates(q1, r1);
                const [x2, y2] = getHexCoordinates(q2, r2);

                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.strokeStyle = playerColors[owner_id];
                ctx.lineWidth = 5;
                ctx.stroke();
            });

            // Draw settlements/cities
            boardState.vertex_cells.forEach(vertex => {
                if (vertex.building) {
                    const [x, y] = getHexCoordinates(vertex.q, vertex.r);
                    const size = vertex.building === 'settlement' ? 7 : 9;
                    
                    ctx.fillStyle = playerColors[vertex.owner_id];
                    if (vertex.building === 'settlement') {
                        // Draw settlement (triangle)
                        ctx.beginPath();
                        ctx.moveTo(x, y - size);
                        ctx.lineTo(x - size, y + size);
                        ctx.lineTo(x + size, y + size);
                        ctx.closePath();
                        ctx.fill();
                    } else {
                        // Draw city (square)
                        ctx.fillRect(x - size, y - size, size * 2, size * 2);
                    }
                }
            });
        }

        function updateResourceDisplay(resources, elementId) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            Object.entries(resources).forEach(([resource, amount]) => {
                const div = document.createElement('div');
                div.className = 'resource';
                div.innerHTML = `
                    <span>${resource}</span>
                    <span>${amount}</span>
                `;
                container.appendChild(div);
            });
        }

        // Add player selection handling
        document.getElementById('player-select').addEventListener('change', function(e) {
            const playerId = e.target.value;
            document.getElementById('active-player-name').textContent = `Player ${playerId}`;
            fetch('board.json')
                .then(response => response.json())
                .then(boardState => {
                    updateResourceDisplay(boardState.players[playerId], 'active-player-resources');
                });
        });

        // Update the fetch call at the bottom
        fetch('board.json')
            .then(response => response.json())
            .then(boardState => {
                drawBoard(boardState);
                updateResourceDisplay(boardState.bank, 'bank-resources');
                updateResourceDisplay(boardState.players[1], 'active-player-resources');
            })
            .catch(error => console.error('Error loading board:', error));
    </script>
</body>
</html>